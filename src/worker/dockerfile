FROM docker:dind

RUN apk add --no-cache python3 py3-pip
RUN pip install --break-system-packages fastapi uvicorn python-multipart requests

RUN addgroup -S workergroup
RUN adduser -S workeruser -G workergroup

WORKDIR /app
COPY worker.py .

ENV WORKER_ID=0
ENV PRINT_RESULTS=False
ENV MASTER_URL="http://master:80"
ENV TASKS_VOLUME=conf_tasks_volume
ENV WORKER_VOLUME=conf_worker_volume
ENV SUBMISSIONS_VOLUME=conf_submissions_volume

EXPOSE 80

ENTRYPOINT ["uvicorn", "worker:worker_app", "--host", "0.0.0.0", "--port", "80"]


#docker build -t worker ./src/worker
